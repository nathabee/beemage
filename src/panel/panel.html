<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="./panel.css" />
  <title>BeeContour — Extract the main outline</title>
</head>

<body>
  <div id="appRoot">
    <div class="wrap">
      <h1>BeeContour — Extract the main outline</h1>

      <div class="tabs" role="tablist" aria-label="Panel tabs">
        <button id="tabContour" class="tab is-active" role="tab" aria-selected="true" type="button">
          Contour
        </button>

        <button id="tabSegmentation" class="tab" role="tab" aria-selected="false" type="button">
          Segmentation
        </button>

        <button id="tabColors" class="tab" role="tab" aria-selected="false" type="button">
          Colors
        </button>

        <button id="tabSettings" class="tab" role="tab" aria-selected="false" type="button">
          Settings
        </button>

        <button id="tabLogs" class="tab" role="tab" aria-selected="false" type="button">
          Logs
        </button>
      </div>

      <!-- =========================
     CONTOUR VIEW
     ========================= -->
      <section id="viewContour" class="view is-active" role="tabpanel" aria-labelledby="tabContour">
        <p class="muted">
          Drop an image, preview it, run contour extraction, and download the result.
        </p>

        <div id="dropZone" class="dropZone" role="group" aria-label="Image drop zone">
          <div class="dropZoneInner">
            <div class="dropTitle">Drag & drop an image here</div>
            <div class="dropHint muted">or</div>
            <div class="row" style="justify-content:center;">
              <input id="fileInput" type="file" accept="image/*" />
            </div>
          </div>
        </div>

        <div class="row" style="align-items:center;">
          <button id="btnProcess" type="button" disabled>Process</button>
          <button id="btnClean" type="button" disabled>Clean &amp; Smooth</button>
          <button id="btnDownload" type="button" disabled>Download PNG</button>
          <button id="btnVectorize" type="button" disabled>Vectorize (SVG)</button>
          <button id="btnDownloadSvg" type="button" disabled>Download SVG</button>

          <span id="contourSpinner" class="spinner is-hidden" aria-hidden="true"></span>
          <span id="contourStatus" class="status">No image loaded</span>
        </div>

        <div class="grid4">
          <div class="card">
            <div class="cardTitle">Input</div>
            <canvas id="srcCanvas" class="canvas" width="640" height="360" aria-label="Input preview"></canvas>
          </div>

          <div class="card">
            <div class="cardTitle">Output</div>
            <canvas id="outCanvas" class="canvas" width="640" height="360" aria-label="Contour output"></canvas>
          </div>

          <div class="card">
            <div class="cardTitle">Clean 1 (Repaired)</div>
            <canvas id="clean1Canvas" class="canvas" width="640" height="360" aria-label="Clean stage 1"></canvas>
          </div>

          <div class="card">
            <div class="cardTitle">Clean 2 (Smoothed)</div>
            <canvas id="clean2Canvas" class="canvas" width="640" height="360" aria-label="Clean stage 2"></canvas>
          </div>
        </div>

        <details class="searchBox" id="svgBox" role="group">
          <summary>SVG Preview</summary>

          <div class="row" style="align-items:flex-start;">
            <div class="card" style="flex:1; min-width: 280px;">
              <div class="cardTitle">Rendered</div>
              <img id="svgPreviewImg" alt="SVG preview"
                style="width:100%; height:auto; border-radius:10px; border:1px solid rgba(255,255,255,0.12); background:rgba(255,255,255,0.03);" />
            </div>

            <div class="card" style="flex:1; min-width: 280px;">
              <div class="cardTitle">SVG Markup</div>
              <pre id="svgPreviewText" class="report" aria-label="SVG markup preview"></pre>
            </div>
          </div>
        </details>


        <details class="searchBox" id="contourOptionsBox" role="group" open>
          <summary>Options</summary>

          <p class="muted" style="margin-top:0;">
            Contour parameters are configured in the <strong>Tuning</strong> section below.
          </p>

          <div class="row" style="align-items:center; margin-top:10px;">
            <span class="muted" style="min-width:90px;">Quality</span>
            <span id="cleanQualityBadge" class="qBadge qBadge--off">—</span>

            <div class="qBar" aria-label="Clean quality">
              <div id="cleanQualityFill" class="qBarFill" style="width:0%;"></div>
            </div>

            <span id="cleanQualityText" class="status"></span>
          </div>
        </details>


        <!-- Contour tab: TUNING (scoped) -->
        <details class="searchBox" id="contourTuningBox" role="group" open>
          <summary>Tuning</summary>

          <p class="muted" style="margin-top:0;">
            Contour-only tuning (mirrors central tuning state).
          </p>

          <div id="contourTuningMount"></div>
        </details>

      </section>

      <!-- =========================
     SEGMENTATION VIEW
     ========================= -->
      <section id="viewSegmentation" class="view" role="tabpanel" aria-labelledby="tabSegmentation" hidden>
        <div class="segLayout">
          <!-- Left: Preset library -->
          <div class="segPresets">
            <div class="segHeaderRow">
              <div class="segTitle">Presets</div>
              <div class="muted" style="font-size:12px;">Drag a preset onto a step.</div>
            </div>

            <!-- Filled by view.ts -->
            <div id="segPresetList" class="segPresetList" aria-label="Segmentation preset library"></div>
          </div>

          <!-- Right: Fixed pipeline -->
          <div class="segPipeline">
            <div class="segHeaderRow">
              <div class="segTitle">Pipeline</div>

              <div class="segHeaderActions">
                <button id="segRunBtn" class="btn" type="button">Run</button>
                <span id="segStatus" class="muted" style="font-size:12px;">Idle</span>

                <div id="segRecipeDrop" class="segDropZone segDropZoneHeader" data-seg-drop="recipe"
                  aria-label="Drop a full recipe preset here" title="Drop a recipe preset here">
                  <span class="segStepAssigned muted" data-assigned>Drop recipe here</span>
                </div>
              </div>
            </div>


            <div class="segSteps" aria-label="Segmentation steps">
              <div id="segStepResize" class="segDropZone segStep" data-seg-step="segmentation.resize"
                aria-label="Resize step drop zone">
                <div class="segStepTitle">1. Resize</div>
                <div class="segStepAssigned muted" data-assigned>Drop preset…</div>
              </div>

              <div id="segStepDenoise" class="segDropZone segStep" data-seg-step="segmentation.denoise"
                aria-label="Denoise step drop zone">
                <div class="segStepTitle">2. Denoise</div>
                <div class="segStepAssigned muted" data-assigned>Drop preset…</div>
              </div>

              <div id="segStepColor" class="segDropZone segStep" data-seg-step="segmentation.color"
                aria-label="Color step drop zone">
                <div class="segStepTitle">3. Color / Gray</div>
                <div class="segStepAssigned muted" data-assigned>Drop preset…</div>
              </div>

              <div id="segStepThreshold" class="segDropZone segStep" data-seg-step="segmentation.threshold"
                aria-label="Threshold step drop zone">
                <div class="segStepTitle">4. Threshold</div>
                <div class="segStepAssigned muted" data-assigned>Drop preset…</div>
              </div>

              <div id="segStepMorphology" class="segDropZone segStep" data-seg-step="segmentation.morphology"
                aria-label="Morphology step drop zone">
                <div class="segStepTitle">5. Morphology cleanup</div>
                <div class="segStepAssigned muted" data-assigned>Drop preset…</div>
              </div>
            </div>

            <div class="segPreview" style="margin-top:12px;">
              <div class="muted" style="font-size:12px; margin-bottom:6px;">Mask preview</div>
              <canvas id="segMaskCanvas" class="segCanvas" aria-label="Segmentation mask preview"></canvas>
            </div>


            <details class="searchBox" role="group" open style="margin-top:12px;">
              <summary>Status</summary>
              <div class="muted" style="font-size:12px; line-height:1.4;">
                Fixed pipeline order. Presets configure each step (algo + params) via tuning store.
              </div>
            </details>
          </div>
        </div>
      </section>




      <!-- =========================
     COLORS VIEW
     ========================= -->
      <section id="viewColors" class="view" role="tabpanel" aria-labelledby="tabColors" hidden>
        <p class="muted">
          Pick a palette color, click inside a region to preview its outline, then apply the fill.
        </p>

        <details class="searchBox" id="colorsBox" role="group" open>
          <summary>Region fill</summary>

          <div class="colorsLayout">
            <!-- Left: interactive canvas -->
            <div class="colorsCanvasCard">
              <div class="row" style="justify-content:space-between;">
                <div class="muted">Click inside a region</div>
                <span id="colorsStatus" class="status">Idle</span>
              </div>

              <canvas id="colorsCanvas" class="canvas" width="640" height="360"
                aria-label="Color fill preview"></canvas>

              <div class="row" style="margin-top:10px;">
                <button id="btnColorsApply" type="button" disabled>Apply fill</button>
                <button id="btnColorsCancel" type="button" disabled>Cancel preview</button>
                <button id="btnColorsReset" type="button">Reset (reload output)</button>
              </div>
            </div>

            <!-- Right: palette + controls -->
            <div class="colorsSide">
              <div class="colorGroup">
                <div class="colorGroupTitle">Palette</div>
                <div id="palette" class="palette" role="list" aria-label="Color palette"></div>
                <div class="muted" style="font-size:12px; margin-top:8px;">
                  Selected color is highlighted.
                </div>
              </div>

              <div class="colorGroup">
                <div class="colorGroupTitle">Edge / noise controls</div>

                <label class="fieldInline">
                  <span>Edges are dark</span>
                  <input id="edgesDark" type="checkbox" checked />
                </label>

                <label class="fieldInline">
                  <span>Edge threshold</span>
                  <input id="edgeMaskThreshold" type="number" inputmode="numeric" min="0" max="255" step="1"
                    value="80" />
                </label>

                <label class="fieldInline">
                  <span>Gap close (px)</span>
                  <input id="edgeDilate" type="number" inputmode="numeric" min="0" max="6" step="1" value="2" />
                </label>

                <label class="fieldInline">
                  <span>Max region (px)</span>
                  <input id="maxRegionPx" type="number" inputmode="numeric" min="1000" step="1000" value="200000" />
                </label>
              </div>
            </div>
          </div>
        </details>
      </section>


      <!-- =========================
           SETTINGS VIEW
           ========================= -->
      <section id="viewSettings" class="view" role="tabpanel" aria-labelledby="tabSettings" hidden>
        <p class="muted">
          Configure developer options and view project info.
        </p>

        <!-- GENERAL -->
        <details class="searchBox" id="settingsGeneralBox" role="group" open>
          <summary>General</summary>

          <div class="row">
            <label class="confirm" style="margin-right: auto;">
              <input id="cfgShowDevTools" type="checkbox" />
              Show developer tools (Logs, debug options)
            </label>

            <span id="settingsGeneralStatus" class="muted"></span>
          </div>
        </details>

        <!-- DEVELOPER -->
        <details id="devConfigDetails" class="searchBox" role="group" open>
          <summary>Developer</summary>

          <div class="devConfigGrid">
            <!-- Column 1 -->
            <div class="devGroup">
              <div class="devGroupTitle">Console</div>

              <label class="devRow">
                <input id="cfgTraceConsole" type="checkbox" />
                <span>Console trace (developer)</span>
              </label>
            </div>

            <!-- Column 2 -->
            <div class="devGroup">
              <div class="devGroupTitle">Storage limits</div>

              <label class="devRowSplit">
                <span>Action log max stored entries</span>
                <input id="cfgActionLogMax" type="number" min="100" step="100" value="5000" />
              </label>

              <label class="devRowSplit">
                <span>Debug trace max stored entries</span>
                <input id="cfgDebugTraceMax" type="number" min="100" step="100" value="2000" />
              </label>

              <label class="devRowSplit">
                <span>Max failure entries per run</span>
                <input id="cfgFailureLogsPerRun" type="number" min="0" step="10" value="50" />
              </label>
            </div>

            <!-- Column 3 -->
            <div class="devGroup">
              <div class="devGroupTitle">Debug</div>

              <label class="confirm">
                <input id="logsCbDebug" type="checkbox" />
                Debug enabled (OFF wipes all debug traces)
              </label>

              <div class="devActionsRow">
                <button id="btnCfgResetDefaults" type="button">Reset defaults</button>
                <span id="cfgStatus" class="muted"></span>
              </div>
            </div>
          </div>
        </details>

        <!-- ENGINE -->
        <details class="searchBox" id="settingsEngineBox" role="group" open>
          <summary>Engine</summary>

          <p class="muted" style="margin-top: 0;">
            OpenCV is demo-only. The extension build never allows injection.
          </p>


          <div class="row" style="align-items:center;">
            <label class="switch" title="Demo only. When enabled, loads OpenCV (once) and enables OpenCV mode.">
              <input id="cfgUseOpenCv" type="checkbox" />
              <span class="switchTrack" aria-hidden="true"></span>
              <span class="switchLabel">OpenCV mode</span>
            </label>

            <span id="cfgOpenCvSpinner" class="spinner is-hidden" aria-hidden="true"></span>
            <span id="cfgOpenCvStatus" class="status">Idle</span>
          </div>


          <div class="row" style="margin-top:10px; align-items:flex-start;">
            <div class="card" style="flex:1; min-width: 280px;">
              <div class="cardTitle">Report</div>
              <pre id="cfgOpenCvReport" class="report"
                aria-label="OpenCV mode report">Toggle “OpenCV mode” to load OpenCV.</pre>

            </div>

            <div class="card" style="flex:1; min-width: 280px;">
              <div class="cardTitle">Notes</div>
              <div class="muted" style="font-size:12px; line-height:1.4;">
                This checks runtime availability (“is OpenCV injected?”).
                Per-step engine selection is configured in the segmentation pipeline later.
              </div>
            </div>
          </div>
        </details>

        <!-- TUNING -->
        <details class="searchBox" id="settingsTuningBox" role="group" open>
          <summary>Tuning</summary>

          <p class="muted" style="margin-top:0;">
            Central tuning for engines and parameters. Tab UIs may expose shortcuts later.
          </p>

          <div id="tuningMount"></div>
        </details>


        <!-- ABOUT -->
        <details class="searchBox" id="settingsAboutBox" role="group" open>
          <summary>About</summary>

          <div class="row">
            <div style="flex:1; min-width: 180px;">
              Version: <strong id="settingsVersion">—</strong>
            </div>

            <a id="settingsGitHubLink" class="subtle" href="https://github.com/nathabee/beecontour/issues"
              target="_blank" rel="noreferrer">GitHub</a>
          </div>
        </details>
      </section>

      <!-- =========================
           LOGS VIEW 
           ========================= -->
      <section id="viewLogs" class="view" role="tabpanel" aria-labelledby="tabLogs" hidden>

        <!-- AUDIT -->
        <h3>Audit log</h3>

        <div class="row">
          <label class="fieldInline">
            <span>Show</span>
            <input id="logsLimit" type="number" inputmode="numeric" min="10" step="10" value="200" />
          </label>

          <button id="btnLogsRefresh" type="button">Refresh</button>
          <span id="logsStatus" class="status">Idle</span>
        </div>

        <div class="row">
          <label class="fieldInline">
            <span>Trim keep last</span>
            <input id="logsTrimKeep" type="number" inputmode="numeric" min="0" step="100" value="2000" />
          </label>

          <button id="btnLogsTrim" type="button">Trim</button>
          <button id="btnLogsExport" type="button">Export JSON</button>
          <button id="btnLogsClear" type="button" class="danger">Clear</button>
        </div>

        <pre id="logsOut" class="report" aria-live="polite"></pre>

        <!-- DEBUG TRACE -->
        <h3>Debug trace</h3>

        <div class="row">
          <label class="fieldInline">
            <span>Show</span>
            <input id="debugLimit" type="number" inputmode="numeric" min="10" step="10" value="200" />
          </label>

          <button id="btnDebugRefresh" type="button">Refresh debug</button>
          <button id="btnDebugExport" type="button">Export debug JSON</button>
          <button id="btnDebugClear" type="button" class="danger">Clear debug</button>
          <span id="debugStatus" class="status">Idle</span>
        </div>

        <pre id="debugOut" class="report" aria-live="polite"></pre>
      </section>

    </div>
  </div>



  <script type="module" src="../panel.js"></script>





</body>

</html>